# Shower Studies

This repository contains studies related to the development of the shower detection algorithm for the Muon DT L1T of CMS.

The studies are based on the shower primitives generated using the CMSSW emulator ([DTTrigPhase2ShowerProd.cc](https://github.com/cms-sw/cmssw/blob/master/L1Trigger/DTTriggerPhase2/plugins/DTTrigPhase2ShowerProd.cc)). Using this plugin, DTNTuples are created with the code available in this repository: [DTNtuples](https://github.com/DanielEstrada971102/DTNtuples/tree/shower_ntuples).

There a few set of DTNTuples already produced accesible in `/lustrefs`:

- **6 TeV Zprime candidate to have a source of showers**: `/ZprimeToMuMu_M-6000_TuneCP5_14TeV-pythia8/Phase2HLTTDRWinter20DIGI-PU200_110X_mcRun4_realistic_v3-v2/GEN-SIM-DIGI-RAW`, located in `/lustrefs/hdd_pool_dir/L1T/Filter/ThresholdScan_Zprime_DY/last/ZprimeToMuMu_M-6000_PU200/` (Note: this sample appears as INVALID in DAS).

- **Minimum Bias sample to rate studies**: `/MinBias_TuneCP5_14TeV-pythia8/Phase2Spring24DIGIRECOMiniAOD-PU200ALCA_140X_mcRun4_realistic_v4-v2/GEN-SIM-DIGI-RAW-MINIAOD`, located in `/lustrefs/hdd_pool_dir/L1T/Filter/ThresholdScan_Zprime_DY/last/MinBias_PU200/`.

The subdirectories in this repo contains specific studies on the mentioned data:

1. `efficiencies`: This section analyzes the efficiency of the shower algorithm through comparisons based on the simhits of each event. "Real" showers are constructed depending on whether the simulation hits are produced by electrons or not. With this truth definition, the hit and miss fractions of the algorithm are estimated.

2. `rates`: This section estimates the rate of the generated shower primitives.

3. `agreement`: An important aspect is analyzing the agreement between the shower primitives generated by the emulator and those that will be produced by the algorithm in firmware. Using DIGI-level information (hits), `firmware-emulator` is used to reproduce the expected firmware output, which is then compared to the primitives obtained from the CMSSW plugin.

4. `filter-studies`: Before the DT primitives are sent to the track finders, they can go through an intermediate stage known as the "Barrel Filter." In this stage, more refined algorithms are applied to cross the information of DT, shower, and RPC primitives (?). This directory contains studies conducted to evaluate which filtering and selection processes are relevant to include in this stage.

Each directory contains more details about the specific tasks performed there. The analyses presented here assume that the frameworks [DTPatternRecognition](https://github.com/DanielEstrada971102/DTPatternRecognition) and [mplDTs](https://github.com/DanielEstrada971102/mplDTs) are being used. Specific versions are listed as DTPatternRecognition@v3.0.0 and mplDTs@v2.2.0-beta.

## Installation

The installation of the dependencies and the setup of the environment is managed using the `Makefile`. To see all the available targets you can run `make help`.

1. For a direct installation use:

```sh
make install # Optionally set the branch/tag/version/commit with MPLDTS_VERSION=... and DTPR_VERSION=... arguments
```

2. For an installation using local clones of the dependencies use:

```sh
make install-local # Optionally set the paths to the local clones with MPLDTS_PATH=... and DTPR_PATH=... arguments
```

3. For a development installation using a virtual environment and installing the dependencies in non-editable mode use:

```sh
make dev # Optionally set the branch/tag/version/commit with MPLDTS_VERSION=... and DTPR_VERSION=... arguments
```

4. For a development installation using a virtual environment and installing the dependencies in editable mode from local clones use:

```sh
make dev-local # Optionally set the paths to the local clones with MPLDTS_PATH=... and DTPR_PATH=... arguments
```

**Note**: If you are using the `dev` or `dev-local` targets, remember to activate the virtual environment after the installation, and in case you need to delete it, just deactivate it and remove with `make delete-env`.

> [!TIP]
> If it is just first time using the `DTPatternRecognition` tool, you can take a look at [this example](test.py).